{% extends 'base.html' %}
{% block title %}Video Lectures â€“ FlipLearn{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h4 class="fw-bold mb-0"><i class="bi bi-play-circle-fill text-primary me-2"></i>Video Lectures</h4>
  {% if request.user.is_staff or request.user.teacher_profile %}
  <a href="{% url 'upload_video' %}" class="btn btn-primary btn-sm">
    <i class="bi bi-plus-circle me-1"></i>Upload Video
  </a>
  {% endif %}
</div>

<!-- Subject Filter -->
<div class="mb-4 d-flex flex-wrap gap-2">
  <a href="{% url 'videos' %}" class="btn btn-sm {% if not subject %}btn-primary{% else %}btn-outline-secondary{% endif %}">All</a>
  {% for s in subjects %}
  <a href="{% url 'videos_by_subject' s.id %}" class="btn btn-sm {% if subject and subject.id == s.id %}btn-primary{% else %}btn-outline-secondary{% endif %}">
    {{ s.name }}
  </a>
  {% endfor %}
</div>

<div class="row g-4">
  {% for video in videos %}
  <div class="col-md-6 col-lg-4">
    <div class="card border-0 shadow-sm h-100 video-card">
      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center py-3">
        <span class="fw-semibold small">{{ video.subject.name }}</span>
        {% if video.id in watched_ids %}
        <span class="badge bg-success"><i class="bi bi-check-lg me-1"></i>Watched</span>
        {% endif %}
      </div>
      <div class="card-body">
        <h6 class="fw-bold mb-2">{{ video.title }}</h6>
        <p class="text-muted small mb-3">{{ video.description|truncatechars:100 }}</p>
        <div class="d-flex align-items-center text-muted small mb-3">
          <i class="bi bi-clock me-1"></i>{{ video.duration_minutes }} min
          <span class="ms-3"><i class="bi bi-calendar me-1"></i>{{ video.uploaded_at|date:"d M Y" }}</span>
        </div>
      </div>
      <div class="card-footer bg-white border-0 pb-3">
        <a href="{% url 'video_detail' video.id %}" class="btn btn-primary btn-sm w-100">
          <i class="bi bi-play-fill me-1"></i>Watch Lecture
        </a>
      </div>
    </div>
  </div>
  {% empty %}
  <div class="col-12">
    <div class="text-center py-5 text-muted">
      <i class="bi bi-camera-video fs-1 d-block mb-3 opacity-50"></i>
      <h5>No video lectures yet</h5>
      {% if request.user.is_staff or request.user.teacher_profile %}
      <a href="{% url 'upload_video' %}" class="btn btn-primary mt-2">Upload First Video</a>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
